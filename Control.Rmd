---
title: "Control data analysis workbook"
output: html_notebook
---

# Tidy up ICAP data
This code takes in combined .csv files from the ICAP (with Y and time), tidies them up a bit and writes out new files and writes them in to the pivoted folder within rawdat
```{r, warning=FALSE, message = FALSE}
source("SourceCode/extract_and_organize_ICAPdata09012020.R")
```

Next steps, plot out a few samples and decide which time block to use for getting values
Make a list of samples that I think I can get decent data for

# What samples can I get good data for?
will make into a behind the scenes R script for getting total signal for the chunk of time
good time interval is 40 to 95 seconds
```{r, warning=FALSE, message = FALSE}
# libraries
library(tidyverse)

# direct to folder with pivoted data
filenames <- list.files("RawDat/ICAP_run_20200901/Pivoted/", full.names = TRUE)

#load data, combine into one big DF
dat <- list()
for (i in 1:length(filenames)){
  dat[[i]] <- read_csv(filenames[i])
}
dat <- do.call(rbind, dat)

# get only the samples and look at the 75As signal
dat_as <- dat %>%
  filter(element == "75As") %>%
#  filter(!str_detect(sampleID, "blank")) %>%
  filter(time > 40 & time < 95) %>%
  filter(str_detect(sampleID, "Smp"))

dat_as_pooled <- dat_as %>%
  group_by(sampleID, samplerun) %>%
  summarise(As_75_intensity = sum(intenstiy))

g <- ggplot(data = dat_as_pooled, aes(x = sampleID, y = As_75_intensity)) +
  geom_bar(stat = "identity")+
  coord_flip()

g
```

